"use strict";(()=>{var e={};e.id=1967,e.ids=[1967],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},90040:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>d,dynamic:()=>p});var o=r(49303),i=r(88716),n=r(60670),a=r(87070),u=r(10124),c=r(64450),l=r(95167);let p="force-dynamic";async function d(e){try{let{_type:t,_id:r,title:s,slug:o,mainImage:i,excerpt:n}=await e.json();if("post"!==t)return a.NextResponse.json({message:"Not a post"},{status:200});let p=await u.client.fetch('*[_type == "subscriber" && status == "active"]{_id, email}');if(0===p.length)return a.NextResponse.json({message:"No subscribers to notify"},{status:200});let d=`https://therichgradstudent.com/${o.current}`,h=i?(0,l.u)(i).width(600).url():"",f=`
      <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto;">
        ${h?`<img src="${h}" alt="${s}" style="width: 100%; border-radius: 8px; margin-bottom: 20px;" />`:""}
        <h1 style="color: #065f46;">${s}</h1>
        <p style="font-size: 16px; color: #333; line-height: 1.6;">${n||"New content is live on The Rich Grad Student!"}</p>
        <div style="margin-top: 30px;">
          <a href="${d}" style="background-color: #10b981; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">Read Full Post</a>
        </div>
        <p style="margin-top: 40px; font-size: 12px; color: #888;">
          You are receiving this because you subscribed to updates from The Rich Grad Student. 
          <a href="#" style="color: #666;">Unsubscribe</a>
        </p>
      </div>
    `,m=0,b=[];for(let e of p)try{let t=`https://therichgradstudent.com/unsubscribe?id=${e._id}`,r=f.replace('<a href="#" style="color: #666;">Unsubscribe</a>',`<a href="${t}" style="color: #666; text-decoration: underline;">Unsubscribe</a>`);await (0,c.C)({to:[e.email],subject:`New Post: ${s}`,html:r}),m++}catch(t){console.error(`Failed to notify ${e.email}:`,t),b.push(e.email)}return a.NextResponse.json({message:`Notified ${m} subscribers. Errors: ${b.length}`},{status:200})}catch(e){return console.error("Webhook Error:",e),a.NextResponse.json({error:"Webhook failed"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/webhooks/notify/route",pathname:"/api/webhooks/notify",filename:"route",bundlePath:"app/api/webhooks/notify/route"},resolvedPagePath:"C:\\Users\\sbots\\OneDrive\\Desktop\\TheRichGradStudent\\src\\app\\api\\webhooks\\notify\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:b}=h,x="/api/webhooks/notify/route";function y(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:m})}},95167:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(49935),o=r.n(s),i=r(10124);let n=o()(i.client);function a(e){return n.image(e).auto("format").fit("max")}},64450:(e,t,r)=>{r.d(t,{C:()=>o});let s=new(r(2723)).R(process.env.RESEND_API_KEY||"re_123_build_placeholder");async function o({to:e,subject:t,html:r}){if(!process.env.RESEND_API_KEY)return console.warn("RESEND_API_KEY is missing. Email not sent."),{success:!1,error:"Missing API Key"};try{let o=await s.emails.send({from:"onboarding@resend.dev",to:e,subject:t,html:r});return{success:!0,data:o}}catch(e){return console.error("Failed to send email:",e),{success:!1,error:e}}}},10124:(e,t,r)=>{r.d(t,{client:()=>a,s:()=>u});var s=r(57484);let o="92vz1asq",i="production",n="2024-01-01",a=(0,s.eI)({projectId:o,dataset:i,apiVersion:n,useCdn:!0});function u(e){return(0,s.eI)({projectId:o,dataset:i,apiVersion:n,useCdn:!e,perspective:e?"previewDrafts":"published",token:e?.token||process.env.SANITY_API_TOKEN})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,7484,9935,5972,2723],()=>r(90040));module.exports=s})();